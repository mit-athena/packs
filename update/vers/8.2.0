#!/bin/sh

case "$HOSTTYPE" in
sun4)
	# Obsolete files, probably dating from the 7.6 and 7.7 releases
	echo "/etc/athena/sethnm"		>> "$DEADFILES"
	echo "/etc/athena/timed"		>> "$DEADFILES"
	echo "/etc/athena/timedc"		>> "$DEADFILES"
	echo "/etc/athena/verify"		>> "$DEADFILES"
	echo "/etc/gateways"			>> "$DEADFILES"
	echo "/etc/inet/cron"			>> "$DEADFILES"
	echo "/etc/inet/su"			>> "$DEADFILES"
	echo "/etc/mailaliases"			>> "$DEADFILES"
	echo "/etc/makespools"			>> "$DEADFILES"
	echo "/etc/netid"			>> "$DEADFILES"
	echo "/etc/rfs"				>> "$DEADFILES"
	echo "/etc/rmount"			>> "$DEADFILES"
	echo "/etc/rmountall"			>> "$DEADFILES"
	echo "/etc/rumountall"			>> "$DEADFILES"
	echo "/etc/ups_data"			>> "$DEADFILES"
	echo "/usr/bin/X"			>> "$DEADFILES"
	echo "/usr/bin/X11"			>> "$DEADFILES"
	echo "/usr/bin/adv"			>> "$DEADFILES"
	echo "/usr/bin/align_equals"		>> "$DEADFILES"
	echo "/usr/bin/capitalize"		>> "$DEADFILES"
	echo "/usr/bin/dname"			>> "$DEADFILES"
	echo "/usr/bin/dsconfig"		>> "$DEADFILES"
	echo "/usr/bin/fumount"			>> "$DEADFILES"
	echo "/usr/bin/ideal"			>> "$DEADFILES"
	echo "/usr/bin/idload"			>> "$DEADFILES"
	echo "/usr/bin/input_from_defaults"	>> "$DEADFILES"
	echo "/usr/bin/insert_brackets"		>> "$DEADFILES"
	echo "/usr/bin/lnsxts"			>> "$DEADFILES"
	echo "/usr/bin/lnttys"			>> "$DEADFILES"
	echo "/usr/bin/lnxts"			>> "$DEADFILES"
	echo "/usr/bin/nsquery"			>> "$DEADFILES"
	echo "/usr/bin/pic"			>> "$DEADFILES"
	echo "/usr/bin/remove_brackets"		>> "$DEADFILES"
	echo "/usr/bin/rfadmin"			>> "$DEADFILES"
	echo "/usr/bin/rfpasswd"		>> "$DEADFILES"
	echo "/usr/bin/rfstart"			>> "$DEADFILES"
	echo "/usr/bin/rfstop"			>> "$DEADFILES"
	echo "/usr/bin/rmntstat"		>> "$DEADFILES"
	echo "/usr/bin/shift_lines"		>> "$DEADFILES"
	echo "/usr/bin/sunview1"		>> "$DEADFILES"
	echo "/usr/bin/sv_xv_sel_svc"		>> "$DEADFILES"
	echo "/usr/bin/unadv"			>> "$DEADFILES"
	echo "/usr/lib/.text_extras_menu"	>> "$DEADFILES"
	echo "/usr/lib/.textswrc"		>> "$DEADFILES"
	echo "/usr/lib/X"			>> "$DEADFILES"
	echo "/usr/lib/defaults"		>> "$DEADFILES"
	echo "/usr/lib/fonts"			>> "$DEADFILES"
	echo "/usr/lib/fs/lofs/umount"		>> "$DEADFILES"
	echo "/usr/lib/ideal"			>> "$DEADFILES"
	echo "/usr/lib/libadmagt.a"		>> "$DEADFILES"
	echo "/usr/lib/libadmapm.a"		>> "$DEADFILES"
	echo "/usr/lib/libadmcom.a"		>> "$DEADFILES"
	echo "/usr/lib/libadmsec.a"		>> "$DEADFILES"
	echo "/usr/lib/libdl_stubs.a"		>> "$DEADFILES"
	echo "/usr/lib/libform.a"		>> "$DEADFILES"
	echo "/usr/lib/libkstat.a"		>> "$DEADFILES"
	echo "/usr/lib/libmenu.a"		>> "$DEADFILES"
	echo "/usr/lib/libns.a"			>> "$DEADFILES"
	echo "/usr/lib/libnswcompat.a"		>> "$DEADFILES"
	echo "/usr/lib/libnswdns.a"		>> "$DEADFILES"
	echo "/usr/lib/libnswfiles.a"		>> "$DEADFILES"
	echo "/usr/lib/libnswnis.a"		>> "$DEADFILES"
	echo "/usr/lib/libnswnisplus.a"		>> "$DEADFILES"
	echo "/usr/lib/libpanel.a"		>> "$DEADFILES"
	echo "/usr/lib/libresolv.a"		>> "$DEADFILES"
	echo "/usr/lib/libstraddr.a"		>> "$DEADFILES"
	echo "/usr/lib/libswitch.a"		>> "$DEADFILES"
	echo "/usr/lib/libtcpip.a"		>> "$DEADFILES"
	echo "/usr/lib/llib-lform"		>> "$DEADFILES"
	echo "/usr/lib/llib-lform.ln"		>> "$DEADFILES"
	echo "/usr/lib/llib-lmenu"		>> "$DEADFILES"
	echo "/usr/lib/llib-lmenu.ln"		>> "$DEADFILES"
	echo "/usr/lib/llib-lpanel"		>> "$DEADFILES"
	echo "/usr/lib/llib-lpanel.ln"		>> "$DEADFILES"
	echo "/usr/lib/lpd"			>> "$DEADFILES"
	echo "/usr/lib/lpdfilters"		>> "$DEADFILES"
	echo "/usr/lib/makedev"			>> "$DEADFILES"
	echo "/usr/lib/nswdns.so"		>> "$DEADFILES"
	echo "/usr/lib/nswdns.so.1"		>> "$DEADFILES"
	echo "/usr/lib/nswfiles.so"		>> "$DEADFILES"
	echo "/usr/lib/nswfiles.so.1"		>> "$DEADFILES"
	echo "/usr/lib/straddr.so.1"		>> "$DEADFILES"
	echo "/usr/lib/switch.so.1"		>> "$DEADFILES"
	echo "/usr/lib/tcpip.so.1"		>> "$DEADFILES"
	echo "/usr/lib/text_extras_menu"	>> "$DEADFILES"
	echo "/usr/lib/textswrc"		>> "$DEADFILES"
	echo "/usr/nserve"			>> "$DEADFILES"
	echo "/usr/sbin/adv"			>> "$DEADFILES"
	echo "/usr/sbin/cdm"			>> "$DEADFILES"
	echo "/usr/sbin/cdmanager"		>> "$DEADFILES"
	echo "/usr/sbin/cdruninstall"		>> "$DEADFILES"
	echo "/usr/sbin/dname"			>> "$DEADFILES"
	echo "/usr/sbin/fumount"		>> "$DEADFILES"
	echo "/usr/sbin/hostrfs"		>> "$DEADFILES"
	echo "/usr/sbin/idload"			>> "$DEADFILES"
	echo "/usr/sbin/nsquery"		>> "$DEADFILES"
	echo "/usr/sbin/rfadmin"		>> "$DEADFILES"
	echo "/usr/sbin/rfpasswd"		>> "$DEADFILES"
	echo "/usr/sbin/rfstart"		>> "$DEADFILES"
	echo "/usr/sbin/rfstop"			>> "$DEADFILES"
	echo "/usr/sbin/rmntstat"		>> "$DEADFILES"
	echo "/usr/sbin/rmount"			>> "$DEADFILES"
	echo "/usr/sbin/rmountall"		>> "$DEADFILES"
	echo "/usr/sbin/rumountall"		>> "$DEADFILES"
	echo "/usr/sbin/udpublickey"		>> "$DEADFILES"
	echo "/usr/sbin/unadv"			>> "$DEADFILES"
	echo "/usr/share/lib/keytables/layout_20njle" >> "$DEADFILES"
	echo "/usr/share/lib/zoneinfo/US/East-In" >> "$DEADFILES"
	echo "/usr/share/lib/zoneinfo/US/Hawaii=" >> "$DEADFILES"
	echo "/usr/share/lib/zoneinfo/US/Mountai" >> "$DEADFILES"
	# DEADFILES doesn't handle directories.
	rm -rf /usr/lib/fs/rfs /usr/lib/rfs /etc/fs/rfs

	# Dead files missed in the 8.1 release.
	echo "/usr/lib/libX.so"			>> "$DEADFILES"
	echo "/usr/lib/libX11.so"		>> "$DEADFILES"
	echo "/usr/lib/libXaw.so"		>> "$DEADFILES"
	echo "/usr/lib/libXext.so"		>> "$DEADFILES"
	echo "/usr/lib/libXi.so"		>> "$DEADFILES"
	echo "/usr/lib/libXinput.so"		>> "$DEADFILES"
	echo "/usr/lib/libXmu.so"		>> "$DEADFILES"
	echo "/usr/lib/libXol.so"		>> "$DEADFILES"
	echo "/usr/lib/libXt.so"		>> "$DEADFILES"
	echo "/usr/lib/libXtst.so"		>> "$DEADFILES"
	echo "/usr/lib/libucb.so"		>> "$DEADFILES"
	echo "/usr/openwin/lib/X11/system.mwmrc" >> "$DEADFILES"
	echo "/etc/athena/krb.conf.v5"		>> "$DEADFILES"
	echo "/etc/athena/console-ttymon"	>> "$DEADFILES"
	echo "/kernel/strmod/arp"		>> "$DEADFILES"
	cat "$LIBDIR/solaris251-26"		>> "$DEADFILES"

	# Solaris 2.6 binaries reference a symbol "textdomain" not
	# present in the Solaris 2.5.1 shared libraries.  Copy aside
	# binaries used after the OS is tracked.
	echo "/usr/bin/cp"			>> "$OLDBINS"
	echo "/usr/bin/rm"			>> "$OLDBINS"
	echo "/usr/bin/sh"			>> "$OLDBINS"
	echo "/usr/bin/tar"			>> "$OLDBINS"
	echo "/usr/bin/dd"			>> "$OLDBINS"
	echo "/usr/bin/sleep"			>> "$OLDBINS"
	echo "/usr/bin/date"			>> "$OLDBINS"
	echo "/usr/sbin/reboot"			>> "$OLDBINS"
	echo "/usr/sbin/sync"			>> "$OLDBINS"

	# The Solaris 2.6 upgrade is pretty traumatic as far as old
	# binaries running with new shared libraries on an old kernel.
	# Copy aside libraries required by commands which run after
	# the os volume is tracked.
	echo "/usr/lib/libadm.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libsocket.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libnsl.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libelf.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libdl.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libc.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libintl.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libmp.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libw.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libsec.so.1"		>> "$OLDLIBS"
	echo "/usr/lib/libbsm.so.1"		>> "$OLDLIBS"

	echo "/etc/athena/newsyslog.conf"	>> "$CONFCHG"
	echo "/etc/default/sulogin"		>> "$CONFCHG"
	echo "/etc/inet/services"		>> "$CONFCHG"
	echo "/etc/minor_perm"			>> "$CONFCHG"
	echo "/etc/mail/aliases"		>> "$CONFCHG"
	echo "/etc/mail/sendmail.cf"		>> "$CONFCHG"

	# Set variables for an OS update.
	echo "TRACKOS=true"			>> "$CONFVARS"
	echo "NEWOS=true"			>> "$CONFVARS"
	echo "NEWUNIX=true"			>> "$CONFVARS"
	echo "NEWBOOT=true"			>> "$CONFVARS"
	echo "NEWDEVS=true"			>> "$CONFVARS"

	# DEADFILES doesn't handle directories; just nuke this by
	# hand.
	rm -rf /etc/athena/login/fonts

	MACHINE=sun4
	SYSTEM=Solaris
	;;

sgi)
	echo "/etc/aliases"			>> "$CONFCHG"
	echo "/etc/sendmail.cf"			>> "$CONFCHG"

	case `uname -r` in
	5.3)
		echo "/etc/inetd.conf"		>> "$CONFCHG"
		echo "/etc/services"		>> "$CONFCHG"
		MACHINE=INDY
		SYSTEM=IRIX
		;;
	6.3)
		MACHINE=O2
		SYSTEM=IRIX
		;;
	esac
	;;
esac

# We're going to fully-qualified hostnames.  If $HOST does not contain
# a '.', tack on "mit.edu".
if [ `expr "$HOST" : '\.'` -eq 0 ]; then
	HOST=$HOST.mit.edu
fi

# Do a little rc.conf editing to take care of possible updates to HOST,
# MACHINE, and SYSTEM.  We have to be careful with SYSTEM because it
# isn't already present on the sun4.
ed -s /etc/athena/rc.conf << EOS
/^HOST/s/=[^;]*/=$HOST/
/^MACHINE/s/=[^;]*/=$MACHINE/
w
q
EOS
if [ `grep -c '^SYSTEM' /etc/athena/rc.conf` = 1 ]; then
	ed -s /etc/athena/rc.conf << EOS
/^SYSTEM/s/=[^;]*/=$SYSTEM/
w
q
EOS
else
		cat >> /etc/athena/rc.conf << EOM
SYSTEM=$SYSTEM;		export SYSTEM		#  Type of operating system
EOM
fi

# On Solaris machines with SYNCCONFIG set, update /etc/nodename so we
# don't have to reboot an extra time during this update.
if [ "$HOSTTYPE" = sun4 -a "$SYNCCONFIG" = true ]; then
	rm -f /etc/nodename.new /etc/nodename.saved
	echo "$HOST" > /etc/nodename.new
	ln /etc/nodename /etc/nodename.saved
	mv /etc/nodename.new /etc/nodename
fi

echo "/.cshrc"					>> "$CONFCHG"
echo "/.login"					>> "$CONFCHG"
echo "/.profile"				>> "$CONFCHG"
echo "/.xsession"				>> "$CONFCHG"
echo "/etc/athena/inetd.conf"			>> "$CONFCHG"
echo "/etc/ntp.conf"				>> "$CONFCHG"
echo "/etc/shells"				>> "$CONFCHG"
echo "/etc/sshd_config"				>> "$CONFCHG"
echo "/etc/syslog.conf"				>> "$CONFCHG"
echo "/var/spool/cron/crontabs/root"		>> "$CONFCHG"

echo "/usr/sipb"				>> "$DEADFILES"
# Cleanup after various cracking incidents

# Skull virus of 19971027:
echo "/etc/athena/login/bitmaps/skl"		>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/skleyes0.xbm"	>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/skleyes1.xbm"	>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/skleyes2.xbm"	>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/skleyes3.xbm"	>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/skleyes4.xbm"	>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/skleyes5.xbm"	>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/.index"		>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/.rc"		>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/.sh42"		>> "$DEADFILES"
echo "/etc/athena/login/bitmaps/.netscaperc"	>> "$DEADFILES"
echo "/etc/athena/login/.Xlogin.old"		>> "$DEADFILES"
echo "/etc/athena/login/.Xsession.old"		>> "$DEADFILES"
echo "/usr/adm/syslog"				>> "$DEADFILES"
echo "/usr/adm/lastlog/null"			>> "$DEADFILES"
echo "/.netscaperc"				>> "$DEADFILES"
# $DEADFILES doesn't deal with directories, and besides a private
# workstation could conceivably have a /... directory.
rm -f /.../.index /.../.netscaperc /.../.sh42 /.../.rc /.../skl \
	/.../skleyes?.xbm
rmdir /...

# Thanksgiving RC5 cracking that occured on many cluster machines:
echo "/usr/bin/.test"				>> "$DEADFILES"
echo "/usr/bin/.test.ini"			>> "$DEADFILES"
echo "/usr/bin/.test.log"			>> "$DEADFILES"
echo "/usr/bin/.ckpoint"			>> "$DEADFILES"
echo "/usr/bin/.in"				>> "$DEADFILES"
echo "/usr/bin/.out"				>> "$DEADFILES"
echo "/z2.c"					>> "$DEADFILES"

# Another RC5 cracking incident:
case "$HOSTTYPE" in
sun4)
	echo "/etc/rc5-sunos-socks4"		>> "$DEADFILES"
	;;
sgi)
	echo "/etc/rc5-irix-socks4"		>> "$DEADFILES"
	;;
esac
echo "/etc/rc5-start"				>> "$DEADFILES"
echo "/etc/rc5-start~"				>> "$DEADFILES"
echo "/var/spool/cron/crontabs/bin"		>> "$DEADFILES"

#!/sbin/sh
# $Id: athchanges,v 1.6 2003-04-09 19:53:45 ghudson Exp $
# athchanges - Set up configuration files required by Athena software.

# Unlike oschanges, this script is run under a chroot into the update
# or install root, so it does not have to honor $UPDATE_ROOT.

umask 022
PATH=/usr/athena/bin:/usr/bin
export PATH

# Recreate GConf schemas.
gdir=/etc/athena/gconf
rm -rf $gdir/gconf.xml.defaults
mkdir $gdir/gconf.xml.defaults
GCONF_CONFIG_SOURCE=xml::$gdir/gconf.xml.defaults
export GCONF_CONFIG_SOURCE
# athena-panel-config.schemas has to be installed last, since it
# overlaps with panel-per-panel-config.schemas right now.
for f in $gdir/schemas/*.schemas $gdir/schemas/athena-panel-config.schemas; do
  gconftool-2 --makefile-install-rule $f > /dev/null 2>&1
done

# Create pango module config.
mkdir -p /etc/athena/pango
pango-querymodules > /etc/athena/pango/pango.modules

# Create gtk module configs.
mkdir -p /etc/athena/gtk-2.0
gtk-query-immodules-2.0 > /etc/athena/gtk-2.0/gtk.immodules
gdk-pixbuf-query-loaders > /etc/athena/gtk-2.0/gdk-pixbuf.loaders

# Create fontconfig cache.
fc-cache -f 2>/dev/null

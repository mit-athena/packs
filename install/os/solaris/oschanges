#!/sbin/sh
# Undo any undesired changes resulting from the installation of OS pkgs.
# $Id: oschanges,v 1.27 2006-03-09 23:26:20 rbasch Exp $

# Restore various files which belong to the OS, but which are replaced
# in the Athena release.
copy_from_srvd() {
  file=$1
  rm -f $UPDATE_ROOT$file
  cp -p /srvd$file $UPDATE_ROOT$file
}

copy_from_srvd /etc/default/cron
copy_from_srvd /etc/default/init
copy_from_srvd /etc/default/su
copy_from_srvd /lib/svc/method/console-login
copy_from_srvd /etc/logindevperm
copy_from_srvd /etc/name_to_sysnum
copy_from_srvd /etc/nsswitch.conf
copy_from_srvd /etc/fonts/fonts.conf
copy_from_srvd /usr/bin/login
copy_from_srvd /usr/openwin/lib/app-defaults/XTerm
copy_from_srvd /usr/openwin/share/etc/keytables/keytable.map

# Recreate various symlinks which replace OS entities.
relink() {
  path=$1
  target=$2
  rm -f $UPDATE_ROOT$path
  ln -s $target $UPDATE_ROOT$path
}

# Point the SMF name service profile symlink at the dns version.
# This ensures that the dns/client service is properly enabled.
relink /var/svc/profile/name_service.xml ns_dns.xml

relink /usr/bin/lp /usr/athena/bin/lp
relink /usr/bin/lpstat /usr/athena/bin/lpstat

# /usr/lib/print/printd is normally a link to /usr/bin/lp, but,
# since we have just linked the latter to the athena lp, we
# copy in the real lp from the /os tree instead.
rm -f $UPDATE_ROOT/usr/lib/print/printd
cp -p /os/usr/bin/lp $UPDATE_ROOT/usr/lib/print/printd

# removed
rm -f $UPDATE_ROOT/etc/rc2.d/S89bdconfig
rm -f $UPDATE_ROOT/etc/rc2.d/S95IIim
rm -f $UPDATE_ROOT/etc/rc2.d/S99audit
rm -f $UPDATE_ROOT/etc/rc2.d/S90wbem
rm -f $UPDATE_ROOT/etc/rc3.d/S76snmpdx
rm -f $UPDATE_ROOT/etc/rc3.d/S77dmi
rm -f $UPDATE_ROOT/etc/rc3.d/S82initsma

# The SUNWgccruntime package installs these libtool library files
# as zero-length, which breaks libtool.  Remove them, so that
# libtool falls back to using the actual library.
rm -f $UPDATE_ROOT/usr/sfw/lib/libstdc++.la
rm -f $UPDATE_ROOT/usr/sfw/lib/libsupc++.la

# Make sure /tmp is a symlink.  /var/rtmp is created by the install.
if [ ! -h $UPDATE_ROOT/tmp ]; then
  rm -rf $UPDATE_ROOT/tmp
  ln -s var/rtmp $UPDATE_ROOT/tmp
fi

#!/sbin/sh
# Undo any undesired changes resulting from the installation of OS pkgs.
# $Id: oschanges,v 1.21 2004-06-24 12:27:05 rbasch Exp $

# Restore various files which belong to the OS, but which are replaced
# in the Athena release.
copy_from_srvd() {
  file=$1
  rm -f $UPDATE_ROOT$file
  cp -p /srvd$file $UPDATE_ROOT$file
}

copy_from_srvd /etc/default/cron
copy_from_srvd /etc/default/init
copy_from_srvd /etc/default/su
copy_from_srvd /etc/init.d/inetsvc
copy_from_srvd /etc/init.d/nfs.client
copy_from_srvd /etc/init.d/rpc
copy_from_srvd /etc/inittab && [ ${UPDATE_ROOT:-/} = / ] && /etc/telinit q
copy_from_srvd /etc/logindevperm
copy_from_srvd /etc/name_to_sysnum
copy_from_srvd /etc/nsswitch.conf
copy_from_srvd /usr/bin/login
copy_from_srvd /usr/openwin/lib/app-defaults/XTerm
copy_from_srvd /usr/openwin/share/etc/keytables/keytable.map

# Recreate various symlinks which replace OS entities.
relink() {
  path=$1
  target=$2
  rm -f $UPDATE_ROOT$path
  ln -s $target $UPDATE_ROOT$path
}

relink /etc/rc0.d/K41rpc ../init.d/rpc
relink /etc/rc0.d/K42inetsvc ../init.d/inetsvc
relink /etc/rc1.d/K41rpc ../init.d/rpc
relink /etc/rc1.d/K42inetsvc ../init.d/inetsvc
relink /etc/rc2.d/S71rpc ../init.d/rpc
relink /etc/rc2.d/S72inetsvc ../init.d/inetsvc
relink /etc/rcS.d/K41rpc ../init.d/rpc
relink /etc/rcS.d/K42inetsvc ../init.d/inetsvc
relink /usr/bin/lp /usr/athena/bin/lp
relink /usr/lib/print/printd /os/usr/bin/lp

# removed
rm -f $UPDATE_ROOT/etc/rc2.d/S25tsaldog
rm -f $UPDATE_ROOT/etc/rc2.d/S76nscd
rm -f $UPDATE_ROOT/etc/rc2.d/S85power
rm -f $UPDATE_ROOT/etc/rc2.d/S88sendmail
rm -f $UPDATE_ROOT/etc/rc2.d/S89bdconfig
rm -f $UPDATE_ROOT/etc/rc2.d/S95IIim
rm -f $UPDATE_ROOT/etc/rc2.d/S99audit
rm -f $UPDATE_ROOT/etc/rc2.d/S80lp
rm -f $UPDATE_ROOT/etc/rc2.d/S90wbem
rm -f $UPDATE_ROOT/etc/rc2.d/S94skiserv
rm -f $UPDATE_ROOT/etc/rc3.d/S76snmpdx
rm -f $UPDATE_ROOT/etc/rc3.d/S77dmi

# Make sure /tmp is a symlink.  /var/rtmp is created by the install.
if [ ! -h $UPDATE_ROOT/tmp ]; then
  rm -rf $UPDATE_ROOT/tmp
  ln -s var/rtmp $UPDATE_ROOT/tmp
fi

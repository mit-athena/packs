Name: athena-inetd
Summary: The Athena version of Internet master daemon server.
Copyright: BSD
Group: System Environment/Daemons

%description
Athena needs this modified version of inetd to support special Athena
functions, it runs along side the normal system inetd.

%install
rm -rf $RPM_BUILD_ROOT
mkdir $RPM_BUILD_ROOT
./do.sh -p -s /xxx -d $RPM_BUILD_ROOT install

# Extra files
mkdir -p $RPM_BUILD_ROOT/etc/athena
cp inetd.conf.athena $RPM_BUILD_ROOT/etc/athena/inetd.conf

%ifos linux
mkdir -p $RPM_BUILD_ROOT/etc/rc.d/init.d
cp athena-inetd.rc $RPM_BUILD_ROOT/etc/rc.d/init.d/athena-inetd
chmod +x $RPM_BUILD_ROOT/etc/rc.d/init.d/athena-inetd
%else
mkdir -p $RPM_BUILD_ROOT/etc/init.d
mkdir -p $RPM_BUILD_ROOT/etc/rc2.d
mkdir -p $RPM_BUILD_ROOT/etc/rc0.d
cp athena-inetd.rc $RPM_BUILD_ROOT/etc/init.d/athena-inetd
chmod +x $RPM_BUILD_ROOT/etc/init.d/athena-inetd
ln -s ../init.d/athena-inetd $RPM_BUILD_ROOT/etc/rc2.d/S91athena-inetd
ln -s ../init.d/athena-inetd $RPM_BUILD_ROOT/etc/rc0.d/K91athena-inetd
%endif

find $RPM_BUILD_ROOT -type f -or -type l |
  sed -e "s|^$RPM_BUILD_ROOT||" \
      -e "s|^/etc/athena/inetd.conf$|%config \0|" |
  sort > rpm.filelist



%post
grep -q ^ACCESSON /etc/athena/rc.conf || cat << EOF >> /etc/athena/rc.conf
ACCESSON=false;		export ACCESSON		#  Access on by default
EOF

%ifos linux
chkconfig --add athena-inetd
%endif

%ifos linux
%triggerin -- setup
( grep -s -q ^rkinit /etc/services \
	|| echo "rkinit	2108/tcp	rkinitd	# Remote ticket granting svc."
 grep -s -q ^write /etc/services \
	|| echo "write	811/tcp			# Athena remote write service"
 grep -s -q ^busypoll /etc/services \
	|| echo "busypoll	49154/udp	# busy polling port for ws"
 grep -s -q ^athinfo /etc/services \
	|| echo "athinfo	49155/tcp	# workstation info server"
 grep -s -q ^gshell /etc/services \
	|| echo "gshell		3715/tcp	# gsh service"
) >> /etc/services
%endif


%ifos linux
%preun
if [ $1 = 0 ]; then
  chkconfig --del athena-inetd
fi
%endif

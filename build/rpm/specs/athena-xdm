Name: athena-xdm
Summary: The Athena version of the standard X display manager
Copyright: MIT
Group: User Interface/X

Requires: athena-krb5 athena-libal athena-wcl athena-larv athena-libMu

%description
Xdm manages a collection of X displays, which may be on  the
local  host or remote servers.  The design of xdm was guided
by the needs of X terminals as  well  as  the  X  Consortium
standard XDMCP, the X Display Manager Control Protocol.  Xdm
provides services similar to those provided by  init,  getty
and  login  on character terminals: prompting for login name
and password, authenticating the user, and running a  ``ses-
sion.''

%install
if [ X$RPM_BUILD_ROOT = X ]; then
  cat 1>&2 << MESSAGE
You must specify a build root in order to build this package.
Use the --buildroot option to RPM or the buildroot rpmrc entry.
MESSAGE
  exit 1
fi

rm -rf $RPM_BUILD_ROOT
mkdir $RPM_BUILD_ROOT
./do.sh -p -s /xxx -d $RPM_BUILD_ROOT install

mkdir -p $RPM_BUILD_ROOT/var/athena/sessions

%post
# Take over the dm service
if [ ! -f /etc/X11/prefdm.orig ]; then
  cp /etc/X11/prefdm /etc/X11/prefdm.orig
fi
rm -f /etc/X11/prefdm

cat > /etc/X11/prefdm << EOF
#!/bin/sh
/usr/bin/chvt 7
exec /etc/athena/dm /etc/athena/login/config ttyp0 tty7
EOF
chmod +x /etc/X11/prefdm

%files
/etc/athena
/usr/athena
%dir /var/athena/sessions

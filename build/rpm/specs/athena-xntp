Name: athena-xntp
Summary: The Network Time Protocol, to keep Athena workstations in sync
Copyright: David L. Mills
Group: System Environment/Base

%description
The Network Time Protocol, to keep Athena workstations in sync

%install

if [ X$RPM_BUILD_ROOT = X ]; then
  cat 1>&2 << MESSAGE
You must specify a build root in order to build this package.
Use the --buildroot option to RPM or the buildroot rpmrc entry.
MESSAGE
  exit 1
fi

rm -rf $RPM_BUILD_ROOT
mkdir $RPM_BUILD_ROOT
./do.sh -p -s /xxx -d $RPM_BUILD_ROOT install

# Extra files
mkdir -p $RPM_BUILD_ROOT/etc/rc.d/init.d
cp ntp.conf $RPM_BUILD_ROOT/etc/ntp.conf
cp athena-xntp.rc $RPM_BUILD_ROOT/etc/rc.d/init.d/athena-xntp
chmod +x $RPM_BUILD_ROOT/etc/rc.d/init.d/athena-xntp

# It will need this to run.
mkdir -p $RPM_BUILD_ROOT/var/athena

find $RPM_BUILD_ROOT -type f -or -type l |
  sed -e "s|$RPM_BUILD_ROOT||" \
      -e "s|/etc/ntp.conf|%config \0|" |
  sort > rpm.filelist
echo "%dir /var/athena" >> rpm.filelist

%post
grep -q TIMESRV /etc/athena/rc.conf || cat << EOF >> /etc/athena/rc.conf
TIMESRV=false;		export TIMESRV		#  Time server?
EOF

grep -q TIMECLIENT /etc/athena/rc.conf || cat << EOF >> /etc/athena/rc.conf
TIMECLIENT=true;	export TIMECLIENT	#  Timed client?
EOF

grep -q TIMEHUB /etc/athena/rc.conf || cat << EOF >> /etc/athena/rc.conf
TIMEHUB=time.MIT.EDU;	export TIMEHUB		#  Authoritative time source
EOF

chkconfig --add athena-xntp


/* 
 * The following instances are supported
 *	foreach_subdirs(name,subdirs)
 *	do_subdirs_no_imakefile(subdirs)
 *	do_subdirs(subdirs)
 */

#define makefile_target()						@@\
Makefile:: $(ICONFIGFILE)						@@\
	-@if [ -f Makefile ]; then \                                    @@\
        	echo "  rm -f Makefile.bak; mv Makefile Makefile.bak"; \ @@\
		rm -f Makefile.bak; mv Makefile Makefile.bak; \      @@\
        else exit 0; fi                                                 @@\
	$(IMAKE) -DTOPDIR=$(TOP) -DCURDIR=$(CURRENT_DIR) 		@@\

#define foreach_subdirs(name,subdirs)					@@\
name:: FRC								@@\
	@for d in subdirs; \						@@\
	do \								@@\
		(cd $$d; echo "### Making" name "in" `pwd`;	\	@@\
			make $(FLAGS) $(MFLAGS) DESTDIR=$(DESTDIR) name ; \	@@\
			echo "### Done with" `pwd`);		\	@@\
	done

#define do_subdirs(subdirs)						@@\
	foreach_subdirs(all, subdirs)					@@\
	foreach_subdirs(install, subdirs)				@@\
	foreach_subdirs(clean, subdirs)					@@\
	foreach_subdirs(depend, subdirs)				@@\

#define do_subdirs_imakefile(subdirs)					@@\
Makefiles:: Makefile							@@\
	@echo "### Making Makefiles in" `pwd`				@@\
	@for d in subdirs; \						@@\
	do \								@@\
		(cd $$d; echo "### Making Makefile in" `pwd`; \		@@\
			make $(MFLAGS) 	\				@@\
			TOP=../$(TOP)			\		@@\
			CURRENT_DIR=../$(CURRENT_DIR)/$$d	\	@@\
			-f ../Makefile			\		@@\
			Makefile; \					@@\
			make $(MFLAGS) \				@@\
			Makefiles; \					@@\
			echo "### Done with" `pwd`); \			@@\
	done

#define create_depend(files)						@@\
depend::								@@\
	makedepend ${CFLAGS} files
